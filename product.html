<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Page</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background-color: #f5f5f5;
        color: #333;
    }
    header {
        background-color: #4285F4;
        color: white;
        text-align: center;
        padding: 20px;
        font-size: 28px;
        font-weight: bold;
    }
    .container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 20px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .product-images {
        text-align: center;
        position: relative;
    }
    .product-images img {
        max-width: 100%;
        border-radius: 8px;
    }
    .slideshow-buttons {
        margin-top: 10px;
    }
    .slideshow-buttons button {
        padding: 8px 12px;
        margin: 0 5px;
        border: none;
        background-color: #4285F4;
        color: white;
        cursor: pointer;
        border-radius: 5px;
    }
    .product-details h2 {
        color: #4285F4;
        margin-top: 20px;
    }
    .product-details p {
        line-height: 1.6;
    }
</style>
</head>
<body>

<header>Product Details</header>

<div class="container" id="product-container">
    <p>Loading product...</p>
</div>

<script>
async function loadProduct() {
    const params = new URLSearchParams(window.location.search);
    const productId = parseInt(params.get('id'), 10);
    if (!productId) return document.getElementById('product-container').innerHTML = '<p>Invalid product ID.</p>';

    try {
        const response = await fetch('products.json');
        if (!response.ok) throw new Error('Failed to fetch products');
        const products = await response.json();

        const product = products.find(p => p.id === productId);
        if (!product) return document.getElementById('product-container').innerHTML = '<p>Product not found.</p>';

        const container = document.getElementById('product-container');

        // Default: first image
        let currentImageIndex = 0;

        // Slideshow HTML
        container.innerHTML = `
            <div class="product-images">
                <img id="product-image" src="${product.image[0] || product.image}" alt="${product.name}">
                <div class="slideshow-buttons">
                    <button id="prev-btn">Prev</button>
                    <button id="next-btn">Next</button>
                </div>
            </div>
            <div class="product-details">
                <h2>${product.name}</h2>
                <div class="price">Â£${product.price.toFixed(2)}</div>
                <p>${product.description}</p>
                <p><em>Category: ${product.category}</em></p>
                <button ${!product.in_stock ? 'disabled' : ''}>Add to Basket</button>
            </div>
        `;

        const imageElement = document.getElementById('product-image');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // Only show slideshow buttons if there is more than 1 image
        if (!Array.isArray(product.image) || product.image.length < 2) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
        }

        // Slideshow functionality
        prevBtn.addEventListener('click', () => {
            if (Array.isArray(product.image)) {
                currentImageIndex = (currentImageIndex - 1 + product.image.length) % product.image.length;
                imageElement.src = product.image[currentImageIndex];
            }
        });

        nextBtn.addEventListener('click', () => {
            if (Array.isArray(product.image)) {
                currentImageIndex = (currentImageIndex + 1) % product.image.length;
                imageElement.src = product.image[currentImageIndex];
            }
        });

        // Prevent clicking Add to Basket from doing anything extra
        const button = container.querySelector('button');
        button.addEventListener('click', (e) => {
            e.stopPropagation();
            console.log(`${product.name} added to basket`);
        });

    } catch (error) {
        console.error(error);
        document.getElementById('product-container').innerHTML = '<p>Failed to load product. Please try again later.</p>';
    }
}

loadProduct();
</script>

</body>
</html>
