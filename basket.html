<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheese Factory</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="https://theorangecow.github.io/cheese/images/logo/logo.ico">
</head>

<body>
    <header>Cheese factory</header>
    <nav>
        <!--This is the nav bar under the title if you change something here you need to update it on every page-->
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="products.html">Products</a>
        <a href="contact.html">Contact</a>
        <a href="basket.html">Basket</a>
    </nav>
    <div class="container" id="basket-container">
        <p>Loading your basket...</p>
    </div>
    <footer>Â© 2025 Cheese Factory</footer>

    <script>
        async function loadBasket() {
            const container = document.getElementById("basket-container");


            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            if (cart.length === 0) {
                container.innerHTML = '<p class="empty">Your basket is empty ðŸ§€</p>';
                return;
            }

            try {
                const response = await fetch('products.json');
                const products = await response.json();

                container.innerHTML = '';

                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (!product) return;

                    const displayImage = Array.isArray(product.image) ? product.image[0] : product.image;

                    const row = document.createElement('div');
                    row.className = 'product-row';

                    row.innerHTML = `
                <div class="product-info">
                    <img src="${displayImage}" alt="${product.name}">
                    <div>
                        <div class="product-name">${product.name}</div>
                        <div class="quantity" data-id="${product.id}" title="Double-click to edit">${item.quantity}</div>
                    </div>
                </div>
                <button class="delete-btn" data-id="${product.id}">Delete</button>
            `;

                    container.appendChild(row);
                });

                // Handle delete
                container.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        cart = cart.filter(i => i.id !== id);
                        localStorage.setItem('cart', JSON.stringify(cart));
                        loadBasket(); // refresh
                    });
                });

                // Handle quantity editing (double click to edit)
                container.querySelectorAll('.quantity').forEach(span => {
                    span.addEventListener('dblclick', () => {
                        const id = parseInt(span.dataset.id);
                        span.contentEditable = true;
                        span.classList.add('editing');
                        span.focus();

                        span.addEventListener('blur', () => {
                            span.contentEditable = false;
                            span.classList.remove('editing');

                            let newQty = parseInt(span.textContent.trim());
                            if (isNaN(newQty) || newQty < 1) newQty = 1;
                            span.textContent = newQty;

                            const cartItem = cart.find(i => i.id === id);
                            if (cartItem) cartItem.quantity = newQty;

                            localStorage.setItem('cart', JSON.stringify(cart));
                        }, { once: true });
                    });
                });

            } catch (err) {
                console.error(err);
                container.innerHTML = '<p class="empty">Failed to load basket. Please try again later.</p>';
            }
        }

        loadBasket();
    </script>
</body>

</html>